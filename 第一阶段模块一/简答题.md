一、简单题

1、Mybatis动态sql是做什么的？都有哪些动态sql？简述一下动态sql的执行原理？

​      答： （1）意图：Mybatis动态sql可以被用在任意的sql语句映射中，以此完成逻辑判断和动态拼接

​               （2）Mybatis提供了9种动态 SQL：

​          <if/>：通过判断参数值来决定是否使用某个查询条件、判断是否更新某一个字段、判断是否插入某个字段的值

​          <choose/>、<when/>、<otherwise/>：当存在分支处理（多条件）情况时，可以使用<choose/>、<when/>及<otherwise/>

​         <trim/>：格式化输出，也可以通过 trim 标签设定或忽略前后缀来实现

​         <set/>：剔除追加到条件末尾的任何不相关的逗号

​        <foreach/>：foreach 标签主要用于构建 in 条件，可在 sql 中对集合进行迭代

​        <bind/>：参数绑定

​                （3）sql的执行原理：从SQL 参数对象中计算表达式的值,根据表达式的值动态拼接SQL，以此来完成动态 SQL 的功能。

 

2、Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？

​       答：Mybatis仅支持association关联对象和collection关联集合对象的延迟加载，association指的就是一对一，collection指的就是一对多查询。在Mybatis配置文件中，可以配置是否启用延迟加载lazyLoadingEnabled=true|false。

原理：使用CGLIB创建目标对象的代理对象，当调用目标方法时，进入拦截器方法，比如调用a.getB().getName()，拦截器invoke()方法发现a.getB()是null值，那么就会单独发送事先保存好的查询关联B对象的sql，把B查询上来，然后调用a.setB(b)，对a的关联对象b赋值

 

3、Mybatis都有哪些Executor执行器？它们之间的区别是什么？

​       答：Mybatis有三种基本的Executor执行器，SimpleExecutor、ReuseExecutor、BatchExecutor。

SimpleExecutor：每执行一次update或select，就开启一个Statement对象，用完立刻关闭Statement对象。

ReuseExecutor：执行update或select，以sql作为key查找Statement对象，存在就使用，不存在就创建，用完后，不关闭Statement对象，而是放置于Map<String, Statement>内，供下一次使用。

BatchExecutor：执行update（没有select，JDBC批处理不支持select），将所有sql都添加到批处理中（addBatch()），等待统一执行（executeBatch()），它缓存了多个Statement对象，每个Statement对象都是addBatch()完毕后，等待逐一执行executeBatch()批处理。与JDBC批处理相同

 

4、简述下Mybatis的一级、二级缓存（分别从存储结构、范围、失效场景。三个方面来作答）？

​       答：一级缓存:是SqlSession级别的缓存。在操作数据库时需要构造sqlSession对象，在对象中有一个数据结构(HashMap)用于存储缓存数据。不同的sqlSession之间的缓存数据区域是互相不影响的。也就是他只能作用在同一个sqlSession中，不同的sqlSession中的缓存是互相不能读取的, 如果中间存在sqlSession去执行commit操作，就会清空SqlSession中的一级缓存

​      二级缓存:是mapper级别的缓存，给予mapper的nameSpace的，多个SqlSession去操作同一个Mapper的sql语句，多个SqlSession可以共用二级缓存，二级缓存是跨SqlSession的

4、简述Mybatis的插件运行原理，以及如何编写一个插件？

​      答：运行原理：mybatis可以编写针对Executor、StatementHandler、ParameterHandler、ResultSetHandler四个接口的插件，mybatis使用JDK的动态代理为需要拦截的接口生成代理对象，然后实现接口的拦截方法，所以当执行需要拦截的接口方法时，会进入拦截方法

自定义插件：

1.编写类实现Intercepror接口并覆写intercept方法及plugin方法，并根据业务需求可进行增强

2.设置插件的签名，告诉mybatis拦截哪个对象的哪个方法

3.最后将插件注册到全局配置文件中